<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HEART-52</title>
    <style>
        /* Reset and base styles */
        .logo {
             display: block;
             margin: 0 auto 1rem;
             width: 182px;
             max-width: 100%;
             height: auto;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #003366;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 50%, #e9ecef 100%);
            min-height: 100vh;
            padding-bottom: 100px; /* Extra space at absolute bottom */
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #003366;
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            letter-spacing: 2px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.2rem;
            font-weight: 400;
            letter-spacing: 0.5px;
            opacity: 0.9;
        }

        /* Quick Jump Navigation */
        .quick-jump {
            margin-top: 25px;
            text-align: center;
        }

        .jump-instruction {
            font-size: 0.9rem;
            color: rgba(0, 51, 102, 0.7);
            margin-bottom: 10px;
            font-weight: 400;
        }

        .jump-buttons {
            display: flex;
            justify-content: center;
            gap: 3px;
            flex-wrap: nowrap;
        }

        .jump-btn {
            padding: 6px 8px;
            background: transparent;
            color: #003366;
            border: 2px solid rgba(0, 51, 102, 0.3);
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.60rem;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            min-width: 50px;
            flex-shrink: 1;
        }

        .jump-btn:hover {
            background: rgba(51, 153, 204, 0.1);
            border-color: rgba(0, 51, 102, 0.6);
            transform: translateY(-1px);
        }

        /* Highlight animation for jumped-to verse */
        .verse-highlight {
            animation: highlightGlow 2s ease-out;
        }

        @keyframes highlightGlow {
            0% {
                box-shadow: 0 0 20px rgba(0, 51, 102, 0.4);
                border-color: #003366;
                transform: scale(1.02);
            }
            50% {
                box-shadow: 0 0 30px rgba(0, 51, 102, 0.3);
            }
            100% {
                box-shadow: 0 10px 25px rgba(0, 51, 102, 0.1);
                border-color: transparent;
                transform: scale(1);
            }
        }
        .nav {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .nav-btn {
            padding: 10px 20px;
            background: rgba(255,255,255,0.9);
            color: #003366;
            border: 2px solid #3399CC;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: #3399CC;
            color: #ffffff;
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: #003366;
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(0, 51, 102, 0.3);
        }

        /* Main content area */
        .content {
            background: #FFFFFF;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0, 51, 102, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 51, 102, 0.05);
        }

        /* Home page styles */
        .verse-list {
            display: grid;
            gap: 15px;
        }

        .verse-item {
            background: rgba(0, 51, 102, 0.05);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .verse-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 51, 102, 0.225);
            border-color: #003366;
        }

        .verse-number {
            font-size: 1.2rem;
            font-weight: bold;
            color: #003366;
            margin-bottom: 5px;
            font-family: Arial, sans-serif;
        }

        .verse-reference {
            font-size: 1.1rem;
            font-weight: 600;
            color: #003366;
            margin-bottom: 8px;
            font-family: Arial, sans-serif;
        }

        .verse-theme {
            font-size: 0.9rem;
            font-weight: 500;
            color: #3399CC;
            margin-bottom: 8px;
            font-family: Arial, sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .verse-preview {
            color: #003366;
            opacity: 0.7;
            font-style: italic;
            font-family: Arial, sans-serif;
        }

        /* Week indicator */
        .week-indicator {
            text-align: center;
            margin-bottom: 20px;
            padding: 8px 16px;
            background: rgba(0, 51, 102, 0.1);
            border-radius: 20px;
            border: 1px solid rgba(0, 51, 102, 0.2);
            display: inline-block;
            margin: 0 auto 20px auto;
        }

        /* Verse page styles */
        .verse-page {
            text-align: center;
        }

        .verse-display {
            background: rgba(0, 51, 102, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 51, 102, 0.1);
            border: 2px solid #003366;
        }

        .verse-theme-display {
            font-size: 1rem;
            font-weight: 600;
            color: #3399CC;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-family: Arial, sans-serif;
        }

        .verse-text {
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 20px;
            color: #003366;
            text-align: left;
            font-family: Arial, sans-serif;
        }

        .verse-ref {
            font-size: 1.1rem;
            font-weight: bold;
            color: #003366;
            text-align: left;
            font-family: Arial, sans-serif;
        }

        /* Memory training display */
        .memory-display {
            background: rgba(0, 51, 102, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 51, 102, 0.1);
            border: 2px solid #003366;
        }

        .memory-text {
            font-size: 1.3rem;
            line-height: 1.8;
            margin-bottom: 20px;
            color: #003366;
            text-align: left;
            font-family: Arial, sans-serif;
        }

        .memory-ref {
            font-size: 1.1rem;
            font-weight: bold;
            color: #003366;
            text-align: left;
            font-family: Arial, sans-serif;
        }

        /* Audio controls */
        .audio-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .audio-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #003366 0%, #1a4d80 100%);
            color: #FFFFFF;
            border: none;
            border-radius: 30px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 51, 102, 0.3);
        }

        .audio-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 51, 102, 0.4);
        }

        .audio-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .audio-btn.active {
            background: linear-gradient(135deg, #3399CC 0%, #1a7bb8 100%);
            box-shadow: 0 5px 15px rgba(51, 153, 204, 0.3);
        }

        /* Speed controls */
        .speed-controls {
            margin: 20px auto;
            padding: 15px;
            background: rgba(255,255,255,0.8);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            max-width: 400px;
            text-align: center;
        }

        .speed-label {
            color: #003366;
            font-weight: 600;
            margin-bottom: 10px;
            display: block;
        }

        .speed-toggles {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .speed-btn {
            padding: 8px 20px;
            background: white;
            border: 2px solid #003366;
            color: #003366;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .speed-btn.active {
            background: #003366;
            color: white;
        }

        /* Memory training instruction */
        .memory-instruction {
            text-align: center;
            margin: 20px 0 15px 0;
            font-size: 1.1rem;
            font-weight: 600;
            color: #003366;
        }
        
        .section-title {
             text-align: center;
            margin: 20px 0 20px 0;
            font-size: 1.3rem;
            font-weight: 800;
            color: #003366;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-top: 1px solid rgba(0, 51, 102, 0.1);
            padding-top: 30px;
        }

        /* Section Spacer for Scrolling */
        .scroll-spacer {
            height: 5vh; /* Minimal spacing between sections */
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ccc;
            font-size: 0.8rem;
            font-style: italic;
        }
        
        .scroll-spacer::after {
            content: "‚Üì Scroll down for more ‚Üì";
            opacity: 0.5;
        }
        
        .scroll-spacer-bottom {
             height: 30vh; /* Space at bottom to clear previous game when scrolling */
        }

        /* Memory training controls */
        .training-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 8px 16px;
            background: rgba(0, 51, 102, 0.05);
            color: #003366;
            border: 2px solid #003366;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .level-btn:hover {
            background: #003366;
            color: #FFFFFF;
        }

        .level-btn.active {
            background: #3399CC;
            color: #FFFFFF;
            border-color: #3399CC;
        }

        /* THE SPECIAL HIDDEN WORD STYLE */
        .blank {
            display: inline-block;
            background-color: #003366; /* Dark background to cover */
            color: rgba(255, 255, 255, 0.15); /* Very faint text */
            border-radius: 4px;
            margin: 0 2px;
            padding: 0 4px;
            
            /* This clips the text so only the top 35% is visible */
            /* Looks like tops of letters poking out */
            clip-path: polygon(0 0, 100% 0, 100% 40%, 0 40%); 
            
            /* Ensure box takes up full height but we only see top of text content via clip */
            line-height: 1.6; 
            vertical-align: bottom;
            
            /* Prevent selection to avoid cheating */
            user-select: none; 
            
            /* Make it look like a dark bubble */
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            
            position: relative;
            top: 5px; /* Nudge down slightly for effect */
        }

        /* GAME STYLES */
        .game-section {
            margin-top: 20px;
            padding: 20px;
            background: #f0f4f8;
            border-radius: 15px;
            border: 2px solid rgba(0, 51, 102, 0.1);
        }
        
        .game-container {
            text-align: left;
            font-size: 1.2rem;
            line-height: 2.5; /* More line height for inputs */
            margin-bottom: 20px;
        }
        
        .game-input {
            border: none;
            border-bottom: 2px solid #3399CC;
            background: white;
            font-size: 1.1rem;
            color: #003366;
            padding: 2px 0; /* Less horizontal padding */
            margin: 0 3px;
            text-align: center;
            border-radius: 4px 4px 0 0;
            transition: all 0.2s;
            font-family: monospace; /* Monospace helps with letter counting spacing */
            letter-spacing: 2px;
        }
        
        .game-input:focus {
            outline: none;
            border-bottom-color: #003366;
            background: #e6f3ff;
            transform: scale(1.05);
        }
        
        .game-input.correct {
            background-color: #d4edda;
            border-bottom-color: #28a745;
            color: #155724;
        }
        
        .game-input.incorrect {
            background-color: #f8d7da;
            border-bottom-color: #dc3545;
            color: #721c24;
        }

        .game-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .game-btn {
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
            font-size: 1rem;
        }
        
        .btn-check {
            background: #28a745;
            color: white;
        }
        
        .btn-reset {
            background: #6c757d;
            color: white;
        }
        
        .game-btn:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }
        
        .game-feedback {
            text-align: center;
            font-weight: bold;
            min-height: 1.5em;
            margin-top: 10px;
            color: #28a745;
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .content {
                padding: 20px;
            }

            .verse-text {
                font-size: 1.1rem;
            }

            .audio-controls {
                flex-direction: column;
                align-items: center;
            }

            .audio-btn {
                width: 100%;
                max-width: 200px;
            }

            .nav {
                justify-content: center;
            }

            .training-controls {
                flex-direction: column;
                align-items: center;
            }

            .level-btn {
                width: 100%;
                max-width: 150px;
            }

            .jump-buttons {
                gap: 8px;
            }

            .jump-btn {
                font-size: 0.8rem;
                padding: 7px 14px;
                min-width: 70px;
            }

            .memory-instruction {
                font-size: 0.9rem;
                margin: 15px 0 12px 0;
                padding: 0 10px;
            }
            
            .game-input {
                font-size: 1rem;
            }
        }

        /* Hidden class for view switching */
        .hidden {
            display: none !important;
        }

        /* Ministry Bag Satchel Icon */
        .ministry-bag-icon {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1000;
            width: 50px;
            height: 50px;
            transition: transform 0.3s ease;
            margin: 20px;
        }

        .ministry-bag-icon:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ministry Bag Satchel Icon -->
        <a href="https://ministrybag.com" class="ministry-bag-icon">
            <img src="ministrybagsatchel1.svg" alt="Ministry Bag" width="50" height="50" style="filter: drop-shadow(0 0 3px rgba(255, 255, 255, 0.6));">
        </a>
        <header class="header">
           <img src="heart52logo1.svg" alt="Heart-52 Logo" class="logo" />

            <p>52 Verses. 52 Weeks.<br> 
                God's Word in Your Heart.</p>
            
            <!-- Quick Jump Navigation -->
            <div class="quick-jump" id="quick-jump">
                <div class="jump-instruction">Scroll down to</div>
                <div class="jump-buttons">
                    <button class="jump-btn" onclick="jumpToWeek(10)">Week 10</button>
                    <button class="jump-btn" onclick="jumpToWeek(20)">Week 20</button>
                    <button class="jump-btn" onclick="jumpToWeek(30)">Week 30</button>
                    <button class="jump-btn" onclick="jumpToWeek(40)">Week 40</button>
                </div>
            </div>
        </header>

        <nav class="nav">
            <button class="nav-btn active" onclick="showHome()">Home</button>
        </nav>

        <main class="content">
            <!-- Home View -->
            <div id="home-view">
                <div class="verse-list" id="verse-list">
                    <!-- Verse items will be populated by JavaScript -->
                </div>
            </div>

            <!-- Verse View -->
            <div id="verse-view" class="hidden">
                <div class="verse-page">
                    <div class="week-indicator-simple" id="current-week-indicator"></div>
                    
                    <div class="verse-display">
                        <div class="verse-theme-display" id="current-verse-theme"></div>
                        <div class="verse-text" id="current-verse-text"></div>
                        <div class="verse-ref" id="current-verse-ref"></div>
                    </div>

                    <div class="audio-controls">
                        <button class="audio-btn" id="play-once-btn" onclick="playOnce()">
                            üîä Play Once
                        </button>
                        <button class="audio-btn" id="stop-btn" onclick="stopAudio()">
                            ‚èπÔ∏è Stop
                        </button>
                        <button class="audio-btn" id="loop-btn" onclick="toggleLoop()">
                            üîÅ Loop
                        </button>
                    </div>

                    <div class="speed-controls">
                        <label class="speed-label">Voice Speed</label>
                        <div class="speed-toggles">
                            <button class="speed-btn active" id="speed-normal" onclick="setSpeed(1.0)">Normal</button>
                            <button class="speed-btn" id="speed-fast" onclick="setSpeed(1.25)">Faster</button>
                        </div>
                    </div>

                    <!-- SPACER FOR SCROLLING -->
                    <div class="scroll-spacer"></div>

                    <div class="section-title">Memory Practice</div>
                    <div class="memory-instruction">
                        Test your memory by hiding words.
                    </div>

                    <div class="training-controls">
                        <button class="level-btn" onclick="setMemoryLevel(0)">Show All</button>
                        <button class="level-btn active" onclick="setMemoryLevel(1)">Level 1</button>
                        <button class="level-btn" onclick="setMemoryLevel(2)">Level 2</button>
                        <button class="level-btn" onclick="setMemoryLevel(3)">Level 3</button>
                    </div>

                    <div class="memory-display">
                        <div class="memory-ref" id="memory-ref"></div>
                        <div class="memory-text" id="memory-text"></div>
                    </div>
                    
                    <!-- SPACER FOR SCROLLING -->
                    <div class="scroll-spacer"></div>
                    
                    <!-- NEW GAME SECTION -->
                    <div class="section-title">Fill in the Blanks Game</div>
                    <div class="memory-instruction">
                        Type the missing words to lock them in your heart.
                    </div>
                    
                    <div class="training-controls">
                        <button class="level-btn game-level-btn active" onclick="initGame(1)">Level 1</button>
                        <button class="level-btn game-level-btn" onclick="initGame(2)">Level 2</button>
                        <button class="level-btn game-level-btn" onclick="initGame(3)">Level 3</button>
                    </div>

                    <div class="game-section">
                        <div class="game-container" id="game-container">
                            <!-- Game content goes here -->
                        </div>
                        <div class="game-feedback" id="game-feedback"></div>
                        <div class="game-controls">
                            <button class="game-btn btn-reset" onclick="resetGame()">Reset</button>
                            <button class="game-btn btn-check" onclick="checkGame()">Check Answers</button>
                        </div>
                    </div>
                    
                    <!-- SPACER AT BOTTOM -->
                    <div class="scroll-spacer-bottom"></div>

                </div>
            </div>
        </main>
    </div>

    <script>
        let lastScrollY = 0;
        
        // Initialize ministry bag icon visibility
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelector('.ministry-bag-icon').style.display = 'block';
        });
        
        // HEART-52 Complete Collection
        const verses = [
            { reference: "Psalm 119:11", theme: "God's Word", text: "I have stored up your word in my heart, that I might not sin against you." },
            { reference: "John 3:16", theme: "The Gospel", text: "For God so loved the world, that he gave his only Son, that whoever believes in him should not perish but have eternal life." },
            { reference: "Romans 3:23", theme: "Admit Sin", text: "For all have sinned and fall short of the glory of God," },
            { reference: "Romans 6:23", theme: "Admit Sin", text: "For the wages of sin is death, but the free gift of God is eternal life in Christ Jesus our Lord." },
            { reference: "Romans 5:8", theme: "Believe in Jesus as Savior", text: "God shows his love for us in that while we were still sinners, Christ died for us." },
            { reference: "Romans 10:9", theme: "Confess Jesus as Lord", text: "If you confess with your mouth that Jesus is Lord and believe in your heart that God raised him from the dead, you will be saved." },
            { reference: "Colossians 2:6-7", theme: "Discipleship", text: "As you received Christ Jesus the Lord, so walk in him, rooted and built up in him and established in the faith, just as you were taught, abounding in thanksgiving." },
            { reference: "Matthew 28:19-20", theme: "Evangelism", text: "Go therefore and make disciples of all nations, baptizing them in the name of the Father and of the Son and of the Holy Spirit, teaching them to observe all that I have commanded you. And behold, I am with you always, to the end of the age." },
            { reference: "Romans 15:7", theme: "Family of God", text: "Welcome one another as Christ has welcomed you, for the glory of God." },
            { reference: "2 Corinthians 5:17", theme: "Identity in Christ", text: "If anyone is in Christ, he is a new creation. The old has passed away; behold, the new has come." },
            { reference: "John 1:12", theme: "Identity in Christ", text: "To all who did receive him, who believed in his name, he gave the right to become children of God," },
            { reference: "Romans 8:1", theme: "Identity in Christ", text: "There is therefore now no condemnation for those who are in Christ Jesus." },
            { reference: "Matthew 6:9-13", theme: "Prayer", text: "Pray then like this: Our Father in heaven, hallowed be your name. Your kingdom come, your will be done, on earth as it is in heaven. Give us this day our daily bread, and forgive us our debts, as we also have forgiven our debtors. And lead us not into temptation, but deliver us from evil." },
            { reference: "Ephesians 2:8-9", theme: "Salvation", text: "For by grace you have been saved through faith. And this is not your own doing; it is the gift of God, not a result of works, so that no one may boast." },
            { reference: "Romans 8:28", theme: "Trust in God", text: "We know that for those who love God all things work together for good, for those who are called according to his purpose." },
            { reference: "Romans 12:1-2", theme: "Living Sacrifice", text: "I appeal to you therefore, brothers, by the mercies of God, to present your bodies as a living sacrifice, holy and acceptable to God, which is your spiritual worship. Do not be conformed to this world, but be transformed by the renewal of your mind, that by testing you may discern what is the will of God, what is good and acceptable and perfect." },
            { reference: "Galatians 2:20", theme: "Identity in Christ", text: "I have been crucified with Christ. It is no longer I who live, but Christ who lives in me. And the life I now live in the flesh I live by faith in the Son of God, who loved me and gave himself for me." },
            { reference: "1 Corinthians 6:19-20", theme: "Holiness", text: "Do you not know that your body is a temple of the Holy Spirit within you, whom you have from God? You are not your own, for you were bought with a price. So glorify God in your body." },
            { reference: "2 Timothy 3:16-17", theme: "God's Word", text: "All Scripture is breathed out by God and profitable for teaching, for reproof, for correction, and for training in righteousness, that the man of God may be complete, equipped for every good work." },
            { reference: "Hebrews 4:12", theme: "God's Word", text: "For the word of God is living and active, sharper than any two-edged sword, piercing to the division of soul and of spirit, of joints and of marrow, and discerning the thoughts and intentions of the heart." },
            { reference: "Matthew 22:37-39", theme: "Love God and Others", text: "And he said to him, 'You shall love the Lord your God with all your heart and with all your soul and with all your mind. This is the great and first commandment. And a second is like it: You shall love your neighbor as yourself.'" },
            { reference: "John 14:6", theme: "Salvation", text: "Jesus said to him, 'I am the way, and the truth, and the life. No one comes to the Father except through me.'" },
            { reference: "John 15:5", theme: "Identity in Christ", text: "I am the vine; you are the branches. Whoever abides in me and I in him, he it is that bears much fruit, for apart from me you can do nothing." },
            { reference: "1 John 1:9", theme: "Forgiveness", text: "If we confess our sins, he is faithful and just to forgive us our sins and to cleanse us from all unrighteousness." },
            { reference: "Proverbs 3:5-6", theme: "Trust in God", text: "Trust in the Lord with all your heart, and do not lean on your own understanding. In all your ways acknowledge him, and he will make straight your paths." },
            { reference: "Philippians 4:6-7", theme: "Prayer & Peace", text: "Do not be anxious about anything, but in everything by prayer and supplication with thanksgiving let your requests be made known to God. And the peace of God, which surpasses all understanding, will guard your hearts and your minds in Christ Jesus." },
            { reference: "Philippians 4:13", theme: "Strength in Christ", text: "I can do all things through him who strengthens me." },
            { reference: "Philippians 1:6", theme: "Growth in Christ", text: "I am sure of this, that he who began a good work in you will bring it to completion at the day of Jesus Christ." },
            { reference: "Philippians 2:3-5", theme: "Humility", text: "Do nothing from selfish ambition or conceit, but in humility count others more significant than yourselves. Let each of you look not only to his own interests, but also to the interests of others. Have this mind among yourselves, which is yours in Christ Jesus," },
            { reference: "Galatians 5:22-23", theme: "Character", text: "The fruit of the Spirit is love, joy, peace, patience, kindness, goodness, faithfulness, gentleness, self-control; against such things there is no law." },
            { reference: "Colossians 3:23", theme: "Work for the Lord", text: "Whatever you do, work heartily, as for the Lord and not for men," },
            { reference: "Ephesians 4:29", theme: "Speech", text: "Let no corrupting talk come out of your mouths, but only such as is good for building up, as fits the occasion, that it may give grace to those who hear." },
            { reference: "Ephesians 4:32", theme: "Kindness & Forgiveness", text: "Be kind to one another, tenderhearted, forgiving one another, as God in Christ forgave you." },
            { reference: "Ephesians 6:1-3", theme: "Family", text: "Children, obey your parents in the Lord, for this is right. 'Honor your father and mother' (this is the first commandment with a promise), 'that it may go well with you and that you may live long in the land.'" },
            { reference: "1 Thessalonians 5:16-18", theme: "Joy & Prayer", text: "Rejoice always, pray without ceasing, give thanks in all circumstances; for this is the will of God in Christ Jesus for you." },
            { reference: "Matthew 6:33", theme: "Seek the Kingdom", text: "Seek first the kingdom of God and his righteousness, and all these things will be added to you." },
            { reference: "Matthew 5:16", theme: "Witness", text: "Let your light shine before others, so that they may see your good works and give glory to your Father who is in heaven." },
            { reference: "Psalm 23:4", theme: "God's Care", text: "Even though I walk through the valley of the shadow of death, I will fear no evil, for you are with me; your rod and your staff, they comfort me." },
            { reference: "Joshua 1:9", theme: "Courage", text: "Have I not commanded you? Be strong and courageous. Do not be frightened, and do not be dismayed, for the Lord your God is with you wherever you go." },
            { reference: "James 1:22", theme: "Obedience", text: "Be doers of the word, and not hearers only, deceiving yourselves." },
            { reference: "Matthew 7:7", theme: "Prayer", text: "Ask, and it will be given to you; seek, and you will find; knock, and it will be opened to you." },
            { reference: "John 10:10", theme: "Abundant Life", text: "The thief comes only to steal and kill and destroy. I came that they may have life and have it abundantly." },
            { reference: "Micah 6:8", theme: "Justice & Mercy", text: "He has told you, O man, what is good; and what does the Lord require of you but to do justice, and to love kindness, and to walk humbly with your God?" },
            { reference: "Hebrews 11:1", theme: "Faith", text: "Now faith is the assurance of things hoped for, the conviction of things not seen." },
            { reference: "Psalm 37:4", theme: "Desire God", text: "Delight yourself in the Lord, and he will give you the desires of your heart." },
            { reference: "Philippians 3:8", theme: "Treasure Christ", text: "I count everything as loss because of the surpassing worth of knowing Christ Jesus my Lord. For his sake I have suffered the loss of all things and count them as rubbish, in order that I may gain Christ" },
            { reference: "Matthew 6:34", theme: "Trust in God", text: "Do not be anxious about tomorrow, for tomorrow will be anxious for itself. Sufficient for the day is its own trouble." },
            { reference: "James 4:17", theme: "Obedience", text: "So whoever knows the right thing to do and fails to do it, for him it is sin." },
            { reference: "Matthew 7:12", theme: "Golden Rule", text: "Whatever you want men to do to you, do also to them, for this is the Law and the Prophets." },
            { reference: "Genesis 1:1", theme: "Creator God", text: "In the beginning, God created the heavens and the earth." },
            { reference: "2 Peter 1:3", theme: "God's Provision", text: "His divine power has granted to us all things that pertain to life and godliness, through the knowledge of him who called us to his own glory and excellence," },
            { reference: "Revelation 3:20", theme: "Invitation", text: "Behold, I stand at the door and knock. If anyone hears my voice and opens the door, I will come in to him and eat with him, and he with me." }
        ];

        // Global variables
        let currentVerse = null;
        let currentMemoryLevel = 1;
        let currentGameLevel = 1;
        let speechSynthesis = window.speechSynthesis;
        let currentUtterance = null;
        let isLooping = false;
        let speechRate = 1.0;

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            populateVerseList();
            showHome();
            
            // Initialize voices
            if (speechSynthesis.getVoices().length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    console.log('Voices loaded');
                });
            }
        }

        // Populate the home page verse list
        function populateVerseList() {
            const verseList = document.getElementById('verse-list');
            verseList.innerHTML = '';

            verses.forEach((verse, index) => {
                const verseItem = document.createElement('div');
                verseItem.className = 'verse-item';
                verseItem.onclick = () => showVerse(index);

                const firstFiveWords = verse.text.split(' ').slice(0, 5).join(' ') + '...';

                verseItem.innerHTML = `
                    <div class="verse-number">Week ${index + 1}</div>
                    <div class="verse-reference">${verse.reference}</div>
                    <div class="verse-theme">${verse.theme}</div>
                    <div class="verse-preview">${firstFiveWords}</div>
                `;

                verseList.appendChild(verseItem);
            });
        }

        // Navigation functions
        function showHome() {
            document.getElementById('home-view').classList.remove('hidden');
            document.getElementById('verse-view').classList.add('hidden');
            document.getElementById('quick-jump').classList.remove('hidden');
            document.querySelector('.ministry-bag-icon').style.display = 'block';
            updateNavigation('home');
            stopAudio();
            window.scrollTo(0, lastScrollY);
        }

        function showVerse(index) {
            lastScrollY = window.scrollY;
            currentVerse = verses[index];
            document.getElementById('home-view').classList.add('hidden');
            document.getElementById('verse-view').classList.remove('hidden');
            document.getElementById('quick-jump').classList.add('hidden');
            document.querySelector('.ministry-bag-icon').style.display = 'none';
            
            updateNavigation('verse');
            displayVerse();
            updateMemoryText();
            
            // Initialize game for this verse
            initGame(1);

            window.scrollTo(0, 0);
        }

        function jumpToWeek(weekNumber) {
            const targetIndex = weekNumber - 1;
            const verseItems = document.querySelectorAll('.verse-item');
            if (verseItems[targetIndex]) {
                verseItems[targetIndex].scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
                verseItems[targetIndex].classList.add('verse-highlight');
                setTimeout(() => {
                    verseItems[targetIndex].classList.remove('verse-highlight');
                }, 2000);
            }
        }

        function updateNavigation(activeView) {
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(btn => btn.classList.remove('active'));
            if (activeView === 'home') {
                navButtons[0].classList.add('active');
            }
        }

        function displayVerse() {
            if (!currentVerse) return;
            document.getElementById('current-verse-theme').textContent = currentVerse.theme;
            document.getElementById('current-verse-text').textContent = currentVerse.text;
            document.getElementById('current-verse-ref').textContent = currentVerse.reference;
            
            const weekIndicator = document.getElementById('current-week-indicator');
            const weekNumber = verses.indexOf(currentVerse) + 1;
            weekIndicator.textContent = `Week ${weekNumber}`;
            weekIndicator.style.fontSize = '1.5rem';
            weekIndicator.style.fontWeight = 'bold';
            weekIndicator.style.color = '#93C5FD';
            weekIndicator.style.marginBottom = '20px';
        }

        // --- UPDATED AUDIO ENGINE (Male Voice Priority) ---

        function getBestVoice(voices) {
            // Filter for English voices only
            const englishVoices = voices.filter(v => v.lang.includes('en'));
            
            if (englishVoices.length === 0) return voices[0]; // Fallback

            // Ranking system updated for Male preferences
            return englishVoices.sort((a, b) => {
                const getScore = (voice) => {
                    let score = 0;
                    const name = voice.name.toLowerCase();
                    
                    // Male Priority
                    if (name.includes('male')) score += 5;
                    if (name.includes('david')) score += 10; 
                    if (name.includes('daniel')) score += 10;
                    if (name.includes('mark')) score += 10;
                    if (name.includes('guy')) score += 8;
                    if (name.includes('alex')) score += 8;
                    
                    // Quality indicators
                    if (name.includes('enhanced')) score += 2;
                    if (name.includes('premium')) score += 2;
                    
                    return score;
                };
                
                return getScore(b) - getScore(a); // Sort descending
            })[0];
        }

        function playOnce() {
            if (!currentVerse) return;
            stopAudio();
            
            let voices = speechSynthesis.getVoices();
            if (voices.length === 0) {
                speechSynthesis.addEventListener('voiceschanged', () => {
                    voices = speechSynthesis.getVoices();
                    playTextWithBestVoice(voices);
                });
                return;
            }
            playTextWithBestVoice(voices);
        }

        function playTextWithBestVoice(voices) {
            const selectedVoice = getBestVoice(voices);
            console.log("Playing with voice:", selectedVoice.name); // Debugging
            
            const fullText = formatTextForSpeech(currentVerse.text) + '. ' + currentVerse.reference;
            currentUtterance = new SpeechSynthesisUtterance(fullText);
            
            if (selectedVoice) {
                currentUtterance.voice = selectedVoice;
            }
            
            currentUtterance.rate = speechRate;
            
            // Slight pitch adjustment for naturalness
            if (selectedVoice && selectedVoice.name.includes('Google')) {
                currentUtterance.pitch = 1.0;
            } else {
                currentUtterance.pitch = 1.0; 
            }

            updateAudioButtons('playing');
            
            currentUtterance.onend = () => updateAudioButtons('stopped');
            currentUtterance.onerror = () => updateAudioButtons('stopped');

            speechSynthesis.speak(currentUtterance);
        }

        function playLoop() {
            if (!isLooping || !currentVerse) return;

            let voices = speechSynthesis.getVoices();
            const selectedVoice = getBestVoice(voices);
            
            const fullText = formatTextForSpeech(currentVerse.text) + '. ' + currentVerse.reference;
            currentUtterance = new SpeechSynthesisUtterance(fullText);
            
            if (selectedVoice) currentUtterance.voice = selectedVoice;
            currentUtterance.rate = speechRate;

            currentUtterance.onend = () => {
                if (isLooping) setTimeout(() => { if (isLooping) playLoop(); }, 1000);
            };
            
            speechSynthesis.speak(currentUtterance);
        }

        function toggleLoop() {
            if (isLooping) {
                stopAudio();
            } else {
                startLoop();
            }
        }

        function startLoop() {
            if (!currentVerse) return;
            isLooping = true;
            updateAudioButtons('looping');
            playLoop();
        }

        function stopAudio() {
            speechSynthesis.cancel();
            isLooping = false;
            currentUtterance = null;
            updateAudioButtons('stopped');
        }

        function updateAudioButtons(state) {
            const playBtn = document.getElementById('play-once-btn');
            const loopBtn = document.getElementById('loop-btn');
            const stopBtn = document.getElementById('stop-btn');

            playBtn.classList.remove('active');
            loopBtn.classList.remove('active');
            playBtn.disabled = false;
            loopBtn.disabled = false;
            stopBtn.disabled = false;

            if (state === 'playing') {
                playBtn.classList.add('active');
                playBtn.disabled = true;
            } else if (state === 'looping') {
                loopBtn.classList.add('active');
                loopBtn.textContent = '‚è∏Ô∏è Stop Loop';
                playBtn.disabled = true;
            } else {
                loopBtn.textContent = 'üîÅ Loop';
            }
        }

        function setSpeed(rate) {
            speechRate = rate;
            document.getElementById('speed-normal').classList.toggle('active', rate === 1.0);
            document.getElementById('speed-fast').classList.toggle('active', rate === 1.25);
            // If currently playing, restart to apply speed
            if (speechSynthesis.speaking) {
                const wasLooping = isLooping;
                stopAudio();
                if (wasLooping) startLoop(); else playOnce();
            }
        }

        // --- MEMORY LOGIC ---
        function setMemoryLevel(level) {
            currentMemoryLevel = level;
            const btns = document.querySelectorAll('.training-controls .level-btn:not(.game-level-btn)');
            btns.forEach((btn, i) => btn.classList.toggle('active', i === level));
            updateMemoryText();
        }

        function updateMemoryText() {
            if (!currentVerse) return;
            const memoryTextElement = document.getElementById('memory-text');
            document.getElementById('memory-ref').textContent = currentVerse.reference;
            
            if (currentMemoryLevel === 0) {
                memoryTextElement.innerHTML = currentVerse.text;
            } else {
                memoryTextElement.innerHTML = createHiddenText(currentVerse.text, currentMemoryLevel);
            }
        }

        function createHiddenText(text, level) {
            const words = text.split(' ');
            
            // Deterministic hiding based on word index and level
            return words.map((word, index) => {
                // Simple pseudo-random logic
                const shouldHide = ((index + level) % 4) < (level); 
                if (shouldHide) {
                    // Note: class 'blank' has the blackout/top-visible CSS
                    return `<span class="blank">${word}</span>`;
                }
                return word;
            }).join(' ');
        }

        // --- NEW TYPING GAME LOGIC (Upgraded) ---
        function initGame(level) {
            currentGameLevel = level;
            
            // Update buttons
            const gameBtns = document.querySelectorAll('.game-level-btn');
            gameBtns.forEach((btn, i) => btn.classList.toggle('active', i + 1 === level));
            
            renderGame();
        }

        function renderGame() {
            const container = document.getElementById('game-container');
            document.getElementById('game-feedback').textContent = '';
            container.innerHTML = '';
            
            if (!currentVerse) return;
            
            const words = currentVerse.text.split(' ');
            let html = '';
            
            words.forEach((word, index) => {
                // Clean word for checking later
                const cleanWord = word.replace(/[.,;!?"]/g, '');
                const wordLen = cleanWord.length;
                
                let shouldHide = false;
                if (currentGameLevel === 1) shouldHide = (index % 4 === 1); // 25%
                else if (currentGameLevel === 2) shouldHide = (index % 2 === 1); // 50%
                else if (currentGameLevel === 3) shouldHide = (index % 4 !== 0); // 75%
                
                if (shouldHide) {
                    // Calculate width based on word length (roughly 12px per char + padding)
                    const width = Math.max(30, wordLen * 14 + 10);
                    
                    // Add data-length and maxlength to enforce character limit
                    html += `<input type="text" class="game-input" 
                            style="width:${width}px" 
                            data-original="${word}" 
                            data-clean="${cleanWord}"
                            maxlength="${wordLen}"
                            autocomplete="off"> `;
                } else {
                    html += `<span>${word}</span> `;
                }
            });
            
            container.innerHTML = html;
            
            // Add input listeners for auto-advance
            const inputs = container.querySelectorAll('input');
            inputs.forEach((input, idx) => {
                // Check length on input
                input.addEventListener('input', function(e) {
                    const max = parseInt(this.getAttribute('maxlength'));
                    if (this.value.length >= max) {
                        // Try to move to next input
                        if (idx + 1 < inputs.length) {
                            inputs[idx + 1].focus();
                        } else {
                            // If last input, maybe lose focus or check?
                            // Optional: this.blur(); 
                            // Optional: checkGame();
                        }
                    }
                });

                // Check Enter key
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') checkGame();
                });
            });
        }
        
        function checkGame() {
            const inputs = document.querySelectorAll('.game-input');
            let allCorrect = true;
            let mistakes = 0;
            
            inputs.forEach(input => {
                const userVal = input.value.trim().toLowerCase().replace(/[.,;!?"]/g, '');
                const originalClean = input.dataset.clean.toLowerCase();
                
                if (userVal === originalClean) {
                    input.classList.add('correct');
                    input.classList.remove('incorrect');
                } else {
                    input.classList.add('incorrect');
                    input.classList.remove('correct');
                    allCorrect = false;
                    mistakes++;
                }
            });
            
            const feedback = document.getElementById('game-feedback');
            if (allCorrect && inputs.length > 0) {
                feedback.textContent = "üéâ Perfect! You've stored this word in your heart!";
                feedback.style.color = "#28a745";
            } else if (inputs.length === 0) {
                feedback.textContent = "";
            } else {
                feedback.textContent = `Keep going! ${mistakes} word${mistakes > 1 ? 's' : ''} to fix.`;
                feedback.style.color = "#dc3545";
            }
        }
        
        function resetGame() {
            renderGame();
        }

        function formatTextForSpeech(text) {
            return text
                .replace(/,/g, ', ')
                .replace(/;/g, '; ')
                .replace(/\./g, '. ')
                .replace(/\bvs?\.\s/gi, 'verse ')
                .replace(/(\d+):(\d+)/g, '$1 verse $2');
        }

        // Handle back button
        window.addEventListener('popstate', function(event) {
            showHome();
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (document.getElementById('verse-view').classList.contains('hidden')) return;
            
            // Don't trigger shortcuts if typing in game
            if (event.target.tagName === 'INPUT') return;

            switch(event.key) {
                case ' ': event.preventDefault(); playOnce(); break;
                case 'l': event.preventDefault(); toggleLoop(); break;
                case 's': event.preventDefault(); stopAudio(); break;
                case 'Escape': showHome(); break;
            }
        });
    </script>
</body>
</html>